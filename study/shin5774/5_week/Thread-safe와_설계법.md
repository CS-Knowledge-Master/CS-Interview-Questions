# Thread-safe 하다는 의미와 설계하는 법을 설명해보세요.

## 답변
```
Thread-safe란 멀티 스레드환경에서 어떠한 함수,변수,객체가 여러 스레드로부터 접근이 이루어져도 프로그램의 실행에는 지장이 없음을 의미하는것이다.
이를 위해서는 함수가 여러 스레드에서 복합적으로 실행되어도 각각의 결과가 올바르게 나오도록 설계해야하고,공유자원의 사용을 최대한 줄이며, 만약 줄일수가 없다면 뮤텍스나 세마포어를 통해 해당자원으로의 접근을 제한합니다. 또한 이러한 자원으로 스레드가 접근한다면 원자연산을 이용합니다.
```

## 내용 정리
- Thread Safe

  멀티 스레드 프로그래밍에서 일반적으로 어떠한 함수, 변수 혹은 객체가 여러 스레드로부터 접근이 이루어져도 프로그램의 실행에 문제가 없음을 의미한다.

  즉, 동일한 함수가 여러 스레드에서 엇비슷하게 호출되어도 각 스레드에서 함수의 수행결과가 올바르게 나오는것을 의미한다.

    - Thread safe한지 확인하는 방법
        - 전역변수,heap,file등 여러스레드가 동시에 접근 가능한 자원을 사용하는지 확인.
        - 핸들과 포인터를 통한 데이터의 간접 접근 여부
    - Thread Safe를 지키는 방법.
        - Re-entrancy(재진입성)

          어떤 함수가 한 스레드에 의해 실행 되는중, 다른 스레드가 해당 함수를 호출해도 각각의 결과는 올바르게 주어져야 한다.

            - 성립 조건
                - 정적 (전역) 변수의 미사용
                - 정적 (전역) 변수의 주소 반환 안됨.
                - 호출자가 호출시 제공한 매개변수 만으로 동작
                - 싱글턴 객체의 잠금에 의존하면 안됨.
                - 다른 비-재진입 함수를 호출하면 안됨.
        - Thread-local storage

          공유 자원의 사용을 최대한 줄여서 동시접근을 최대한 막는다.

        - Mutual exclusion(=Mutex)

          공유 자원을 무조건적으로 사용해야 하는 경우에는 해당 자원으로의 접근을 세마포어 등의 lock으로 막는다.

        - Atomic operations

          공유 자원에 접근할때 원자 연산을 이용하거나 ‘원자적’으로 정의된 접근방법을 사용함으로 상호배제를 구현할수 있다.

            - 원자연산

              CPU가 처리하는 하나의 단일연산을 의미하한다.

              EX) a++⇒ a의 값을 읽는다 + a의 값을 증가시킨다.

              ⇒ 원자 연산이 아니다.