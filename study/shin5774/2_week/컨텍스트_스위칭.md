# 컨텍스트 스위칭에 대해 설명해주세요.

## 답변
```
컨텍스트 스위칭이란 CPU에서 실행할 프로세스를 바꿔주는 작업입니다. 
```

### 예상 꼬리질문 및 답변
- 어떠한 방식으로 컨텍스트 스위칭이 진행되는지 설명해주세요.
  ```
  컨텍스트 스위칭은 각 프로세스를 의미하는 자료구조인 PCB, 프로세스 컨트롤 블록을 참조하여 수행됩니다.
  우선 현재 동작중인 프로세스에서 다른 프로세스로 컨텍스트 스위칭이 발생한다는 것은, 동작 프로세스의 PCB에 스택 데이터 위치와 프로그램 카운터의 값과 같은 값들을 저장하고 다음으로 실행할 PCB에서 값들을 CPU로 옮겨오는 것입니다. 이를 통해 작동중인 프로세스의 진행과정을 저장하고 다음으로 실행될 프로세스의 작업을 수행할수 있는것입니다.
  ```
    - PCB에 대해 자세히 설명해주세요.
  ```
  PCB는 프로세스 컨트롤 블록의 약자로, 프로세스를 관리하는데 필요한 정보를 포함하는 커널의 자료구조입니다. 
  내부에는 프로세스 ID와 프로세스의 상태 그리고 프로그램 카운터등등이 있습니다.
  ```
- 프로세스의 교체 순서는 어떻게 정하는가?
  ```
  프로세스 스케줄러가 내부의 알고리즘을 통해 결정을 합니다.
  ```
    - 스케줄러에 대해 설명해주세요
  ```
  스케줄러는 어떤 프로세스에게 자원을 할당할지, 즉 작업을 수행할지 결정해주는 프로그램입니다. 
  역할에 따라서 장기,단기,중기로 나뉘게 됩니다.
  이중에서 장기의 경우는 현재 사용되지 않고 단기와 중기를 사용하게 되는데 여기서 CPU에 프로세스를 올리는것은 단기 스케줄러가 담당하는 업무입니다.
  ```
## 내용 정리
- Process Control Block(PCB)

  프로세스 제어 블록, 프로세스를 관리하는데 필요한 정보를 포함하는 운영체제 커널의 자료구조로 운영체제가 프로세스를 표현한것.

    - 구성요소
        - process state

          프로세스의 상태를 저장함

            - 상태
                - 생성,준비,실행,대기,종료로 나뉜다.
        - process number(PID)

          프로세스 식별자를 저장하는 고유한 프로세스 ID

        - program counter(PC)

          프로세스를 위해 실행될 다음 명령어의 주소를 포함하는 카운터를 저장하는곳

        - register

          CPU 레지스터에 있는 정보

        - memory limit

          운영체제에서 사용하는 메모리 관리 시스템에 관한 정보(페이지 테이블,세그먼트 테이블…)

        - list of open files

          프로세스를 위해 열린 파일 목록

        - pointer

          프로세스의 현재 위치를 저장하는 포인터

- Context Switching(컨텍스트 스위칭)

  CPU에서 실행될 프로세스를 교체하는 기술. Process Control Block(PCB)의 값들을 참조하여 프로세스간 전환을 실행함.

  이때 운영체제는 PCB의 빠른 접근을 위해 `프로세스 테이블`을 통해 각 프로세스의 PCB를 관리한다.

    - 발생 시기
        - 멀티 태스킹

          여러 프로세스간의 전환하는 과정

        - 인터럽트 핸들링

          예외상황 발생시 CPU가 실행중인 프로세스 정보를 저장하고 예외상황을 처리하는 과정

        - 사용자 모드와 커널모드간의 전환

          운영체제에 따라 컨텍스트 스위칭이 발생

    - 실행과정
        - 실행중인 프로세스의 SP(Stack Pointer,스택의 데이터 위치)의 값과 PC의 값을 PCB에 저장하고 해당 프로세스의 상태를 ready나 block으로 전환함.
        - 다음의 실행할 프로세스를 실행함. 상태를 running으로 바꿈 → 이 작업을 디스패치라고 함.
        - 실행하는것은 CPU의 레지스터에서 실행되는것이고 교체하는 것은 레지스터 내부에 있는 프로세스의 정보이다.
    - 프로세스 실행 순서의 결정은 `스케줄러`가 특정 알고리즘에 의해 결정한다.
- Scheduler(스케줄러)

  어떤 프로세스에게 자원을 할당할지 결정하는 운영체제 커널의 코드. 역할과 목적에 따라 단기,중기,장기 스케줄러로 나뉜다.

    - 종류
        - 단기 스케줄러

          미리 정한 스케줄링 알고리즘에 의해 실행할 프로세스를 선택함.

          CPU와 메모리 간의 스케줄링을 담당한다.

          ready queue 내부의 프로세스중 어떤 프로세스를 실행할지 결정함,

        - 장기 스케줄러

          작업 스케줄러라고 부르며 어떤 프로세스를 ready queue에 넣을지 결정하는 스케줄러. 디스크에서 어떤 프로그램을 가져올지 결정함. 즉 메모리와 디스크간의 스케줄링을 담당한다.

          현대에는 메모리가 충분해 사용되지 않고 프로세스에 바로 메모리를 할당해 ready queue에 넣어준다.

        - 중기 스케줄러

          메모리의 너무 많은 프로그램이 동시에 올라가 성능을 저하시키는것을 막기위해 이를 조절해주는 스케줄러.

          rready queue에 올라와있는 프로세스중 일부에게 메모리를 전부 빼앗아 해당 내용을 디스크의 swap 영역에 저장해두는것으로 메모리를 확보함. 이를 `swap out`이라고 함.

          봉쇄상태에 있는 프로세스를 처음으로 swap out 시킴 → cpu를 얻을 가능성이 가장 적음.

          그래도 부족하면 interrupt로 인해 ready queue로 올라오려는 프로세르를 swap out 시킴.

          이로 인해 프로세스의 상태에 중지상태(stopped,suspenden)가 추가되었고 해당 상태의 프로세스들은 swap out 된다.

          이후 메모리에 여유가 생기면 다시 swap in을 해준다.

    - 알고리즘
        - 비선점 스케줄링

          프로세스가 CPU를 할당 받고 작업종료후 CPU 반환까지 다른 프로세스는 CPU 점유가 불가능한 방식으로 모든 프로세스의 요구를 공정하게 처리하지만, 비효율적일수 있다.(짧은 작업이 긴 작업을 기다려야함)

            - 종류
                - FCFS(First-Come-First-Served)

                  먼저 들어온 프로세스부터 처리하는 알고리즘.

                    - 장점
                        - 구현이 쉬움
                    - 단점
                        - 대화식 프로세스에 적합하지 않음
                        - 비 효율적
                            - 대화식 프로세스

                              사용자와 상호작용하는 프로세스, 사용자의 입력을 기다리면서 입력에 대한 빠른 응답이 필요한 프로세스

                              예시로는 텍스트 편집기,웹 브라우저,게임등이 있음.

                - SJF(Shortest Job First)

                  실행시간이 가장 짧은 프로세스부터 처리하는 알고리즘.

                    - 장점
                        - 평균 대기시간이 짧음
                    - 단점
                        - 긴 프로세스가 너무 오래 기다릴수도 있음
                        - CPU 할당이 공정하지 않음.
                - 우선순위

                  우선순위별로 프로세스를 처리하는 방식

                    - 장점
                        - 프로세스 별 상대적 중요도 명시 가능
                        - 실시간 시스템에 유리함
                    - 단점
                        - 우선 순위가 낮은 프로세스가 오래 기다릴수 있음.
        - 선점 스케줄링

          CPU가 할당된 프로세스가 작업이 안끝나도 다른 프로세스에게 CPU를 할당하는 방식

            - 종류
                - 우선순위

                  우선순위가 높은 순으로 처리하는 알고리즘. CPU 작업중 우선순위가 더 높은 프로세스가 들어오면 해당 프로세스로 전환

                    - 장점
                        - 응답이 빠름
                    - 단점
                        - 처리시간 예측이 어려움.
                        - 우선순위 프로세스가 계속해서 들어오면 오버헤드가 발생한다.
                - RR(Round-Robin)

                  특정 시간간격으로 돌아가면서 프로세스가 실행되는 알고리즘.

                    - 장점
                        - 공평함.
                        - worst time을 알수 있음.
                    - 단점
                        - 하드웨어 타이머가 필요함.
                        - 작업시간이 너무 짧으면 오버헤드가 일어남.
                - MultiLevel Queue(MLQ)

                  ready queue를 여러 종류,단계로 놓고 각 queue의 우선순위 별로 각 queue의 알고리즘에 맞게 실행하는 구조

                    - 장점
                        - 응답이 빠름
                    - 단점
                        - ready queue와 사용 알고리즘의 수가 다양해서 오버헤드가 발생함.
                        - 우선순위가 낮은 큐의 프로세스가 오래 기다림.
                - MultiLevel Feedback Queue(MLFQ)

                  MLQ에서 프로세스의 queue간 이동이 추가된 형태, 과거의 수행결과에 따라 프로세스의 우선순위를 변경해준다.