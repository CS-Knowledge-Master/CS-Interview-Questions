# 운영체제 - Thread safe


## Thead-safe 하다는 의미는?

>**Thread-safe**란 여러 스레드가 동시에 접근하더라도 프로그램이 예상대로 동작하는 상태를 의미한다.
Thread-safe한 코드는 다중 스레드 환경에서 안전하게 사용될 수 있도록 설계되었으며, 여러 스레드가 공유 자원에 동시에 접근해도 예기치 않은 문제가 발생하지 않는다.


## Thread-safe를 지키기 위한 원칙

#### 1. 원자 연산(Atomic operation)

- 연산이 원자적으로 실행되어야 한다.
- 한 스레드에서 실행 중인 연산은 중간에 다른 스레드에 의해 간섭받지 않아야 한다.

#### 2. 상호 배제(Mutual exclusion)

- 상호 배제는 공유 자원에 대한 동시 접근을 막고, 한 번에 하나의 스레드만이 해당 자원을 사용할 수 있도록 하는 메커니즘을 말한다.
- 이를 통해 여러 스레드가 동시에 공유 자원을 변경하려는 경우 발생할 수 있는 경쟁 조건을 방지할 수 있다.

- 흔히 Mutex나 세마포어를 사용하여 임계 영역 진입 전, 락을 획득하고 작업을 마치면, 락을 반납하여 다른 쓰레드가 접근할 수 있도록 한다.

#### 3. 쓰레드 지역 저장소(Thread-local storage)
- 쓰레드 지역 저장소는 각 스레드가 독립적인 저장 공간을 갖는 메커니즘이다.
- 각 스레드는 자신만의 지역 저장소를 갖고 있으며, 이 저장소에 저장된 변수는 해당 스레드에서만 접근 가능하다. 다른 스레드에서는 이 변수에 직접적으로 접근할 수 없다.

- 쓰레드 지역 저장소를 처음에는 각 스레드가 할당 받은 스택을 의미하는 것인가 했는데, 그게 아니었다.
  이 곳에 저장되는 값들은 전역 변수이지만, 한 쓰레드 내에서만 유효한 전역 변수이다.

- 여러 쓰레드가 하나의 데이터에 몰리게 되는 경우, 많은 스레드들이 대기 상태로 들어간다. 이렇게 공유 상태를 피할 수 없을 때 TLS를 사용한다.


#### 4. 재진입성(Re-entrancy)

- 재진입성은 함수가 동시에 여러 스레드에서 호출되더라도 안전하게 실행될 수 있는 성질을 나타낸다. 즉, 함수 내부에서 사용되는 변수나 자원이 다른 스레드에 의해 변조되지 않도록 하는 것이다.