# 네트워크

## CORS란 무엇이며 이것에 대해 설명해보세요.

---

### CORS란?

CORS (**C**ross-**O**rigin **R**esource **S**haring)

교차 출처 리소스 공유

### 출처(Origin)?

출처는 `[protocol]://[host]:[port]/XXXX`
에서 `[protocol]://[host]:[port]`부분까지를 가리킨다.

즉, **출처가 같다**는 것은 `[protocol]://[host]:[port]`까지가 동일하다는 것과 같은 의미이다.

### SOP란?

SOP (**S**ame **O**rigin **P**olicy)

동일 출처 정책은 javascript 코드 상에서 같은 출처에서만 접근할 수 있도록 브라우저에서 제공하는 기본 정책이다.

### SOP 예외 사항
- `<script>` 태그로 스크립트를 실행하는 경우 
- 이미지를 렌더링 하는 경우
- `<link>` 태그로 CSS 파일을 불러오는 경우
- HTML 문서를 화면에 보여주는 경우

### 그래서 CORS가 뭔데??

브라우저가 SOP를 기본 정책으로 설정해 놓았지만, 실제로 서비스를 하다보면 다른 출처의 리소스를 가져와야 하는 경우가 많다.  
당장 웹 어플리케이션을 서비스하는 상황에서도 사용자가 접속한 웹페이지와 백엔드 서버의 출처가 다르기 때문에 오류가 발생한다.
따라서 다른 출처에서도 리소스 요청을 허용하기 위해 백엔드 서버에서는 웹페이지의 출처를 CORS 설정에 등록할 수 있다.  

### CORS 확인 과정

1. Simple Request  
   - 원하는 요청을 바로 보내는 방법
   - `GET`, `HEAD`, `POST` 메소드만 사용할 수 있음
   - 설정할 수 있는 header에 제한이 있음
   - `Content-Type` 헤더로 설정할 수 있는 media type이 제한
   - CORS는 브라우저 정책이기 때문에, 서버는 CORS 여부에 관계없이 일단 요청을 처리함

2. Preflight Request
   - 원하는 요청을 보내기 전에 `OPTIONS` 메소드로 설정된 예비 요청을 먼저 보내는 방법
   - 예비 요청을 먼저 보냄으로써 본 요청을 항상 처리하는 것을 방지함

3. Credentialed Request
   - Preflight request에 추가로 인증 정보 및 이에 관련된 추가 설정이 필요

### CORS 설정 방법

세 방식 모두 서버에서 응답을 내려줄 때 아래의 header를 설정해준다.  
`Access-Control-Allow-Origin: [출처] (혹은 와일드카드 "*")`

Simple request는 설정할 수 있는 method와 header가 정해져 있지만,  
preflight/credentialed request는 예비 요청이 있기 떄문에 서버에서 허용하는 method와 header를 설정해줄 수 있다.
예시는 아래와 같다.

`Access-Control-Allow-Methods: POST, GET, OPTIONS`  
`Access-Control-Allow-Headers: Content-Type, [다른 커스텀 헤더]`  
`Access-Control-Max-Age: 86400`

Access-Control-Max-Age는 예비 요청에 대한 응답이 브라우저 캐시에 남아있는 시간을 의미하므로, 해당 시간 내에 본 요청을 보내야 한다.

Credentialed request는 인증정보가 존재하는 출처로부터의 요청을 의미하므로,  
`Access-Control-Allow-Origin`에 와일드카드를 사용할 수 없다.  
또한 `Access-Control-Allow-Credentials: true`로 설정해 주어야 한다.
